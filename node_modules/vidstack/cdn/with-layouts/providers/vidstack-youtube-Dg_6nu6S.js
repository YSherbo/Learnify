import{L as b,s as m,e as g,i as v,J as y,a as c,X as f}from"../chunks/vidstack-CfWjVwmq.js";import"../chunks/vidstack-DID3ileE.js";import{T as n}from"../chunks/vidstack-BtDY_Ay-.js";import{p as k}from"../chunks/vidstack-By-MVw1B.js";import{E as w,t as d}from"../chunks/vidstack-CN5Ow39J.js";import{resolveYouTubeVideoId as R}from"../chunks/vidstack-BPxi4x2R.js";import"../chunks/vidstack-CyRzesiL.js";import"../chunks/vidstack-ClIUVQwo.js";const r={Om:-1,pg:0,qg:1,gj:2,hj:3,ij:5};class T extends w{constructor(t,s){super(t),this.b=s,this.$$PROVIDER_TYPE="YOUTUBE",this.scope=b(),this.ha=m(""),this.za=-1,this.md=-1,this.vc=!1,this.ga=0,this.ba=new n(0,0),this.K=null,this.I=null,this.R=null,this.language="en",this.color="red",this.cookies=!1}get c(){return this.b.delegate.c}get currentSrc(){return this.K}get type(){return"youtube"}get videoId(){return this.ha()}preconnect(){k(this.Nb())}setup(){super.setup(),g(this.we.bind(this)),this.c("provider-setup",this)}async play(){const{paused:t}=this.b.$state;return this.I||(this.I=d(()=>{if(this.I=null,t())return"Timed out."}),this.t("playVideo")),this.I.promise}async pause(){const{paused:t}=this.b.$state;return this.R||(this.R=d(()=>{this.R=null,t()}),this.t("pauseVideo")),this.R.promise}setMuted(t){t?this.t("mute"):this.t("unMute")}setCurrentTime(t){this.vc=this.b.$state.paused(),this.t("seekTo",t),this.c("seeking",t)}setVolume(t){this.t("setVolume",t*100)}setPlaybackRate(t){this.t("setPlaybackRate",t)}async loadSource(t){if(!v(t.src)){this.K=null,this.ha.set("");return}const s=R(t.src);this.ha.set(s??""),this.K=t}Nb(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}we(){this.z();const t=this.ha();if(!t){this.sc.set("");return}this.sc.set(`${this.Nb()}/embed/${t}`),this.c("load-start")}mg(){const{keyDisabled:t}=this.b.$props,{muted:s,playsInline:a,nativeControls:o}=this.b.$state,e=o();return{autoplay:0,cc_lang_pref:this.language,cc_load_policy:e?1:void 0,color:this.color,controls:e?1:0,disablekb:!e||t()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:e?1:3,mute:s()?1:0,playsinline:a()?1:0}}t(t,s){this.se({event:"command",func:t,args:s?[s]:void 0})}gd(){window.setTimeout(()=>this.se({event:"listening"}),100)}kd(t){this.c("loaded-metadata"),this.c("loaded-data"),this.b.delegate.Ga(void 0,t)}ib(t){this.R?.resolve(),this.R=null,this.c("pause",void 0,t)}mc(t,s){const{duration:a,realCurrentTime:o}=this.b.$state,e=this.za===r.pg,i=e?a():t,h={currentTime:i,played:this.uc(i)};this.c("time-update",h,s),!e&&Math.abs(i-o())>1&&this.c("seeking",i,s)}uc(t){return this.ga>=t?this.ba:this.ba=new n(0,this.ga=t)}nb(t,s,a){const o={buffered:new n(0,t),seekable:s};this.c("progress",o,a);const{seeking:e,realCurrentTime:i}=this.b.$state;e()&&t>i()&&this.ob(a)}ob(t){const{paused:s,realCurrentTime:a}=this.b.$state;window.clearTimeout(this.md),this.md=window.setTimeout(()=>{this.c("seeked",a(),t),this.md=-1},s()?100:0),this.vc=!1}lc(t){const{seeking:s}=this.b.$state;s()&&this.ob(t),this.c("pause",void 0,t),this.c("end",void 0,t)}ie(t,s){const{started:a,paused:o,seeking:e}=this.b.$state,i=t===r.qg,h=t===r.hj,l=(o()||this.I)&&(h||i);if(h&&this.c("waiting",void 0,s),e()&&i&&this.ob(s),!a()&&l&&this.vc){this.I?.reject("invalid internal play operation"),this.I=null,i&&(this.pause(),this.vc=!1);return}switch(l&&(this.I?.resolve(),this.I=null,this.c("play",void 0,s)),t){case r.ij:this.kd(s);break;case r.qg:this.c("playing",void 0,s);break;case r.gj:this.ib(s);break;case r.pg:this.lc(s);break}this.za=t}te({info:t},s){if(!t)return;const{title:a,intrinsicDuration:o,playbackRate:e}=this.b.$state;if(y(t.videoData)&&t.videoData.title!==a()&&this.c("title-change",t.videoData.title,s),c(t.duration)&&t.duration!==o()){if(c(t.videoLoadedFraction)){const i=t.progressState?.loaded??t.videoLoadedFraction*t.duration,h=new n(0,t.duration);this.nb(i,h,s)}this.c("duration-change",t.duration,s)}if(c(t.playbackRate)&&t.playbackRate!==e()&&this.c("rate-change",t.playbackRate,s),t.progressState){const{current:i,seekableStart:h,seekableEnd:l,loaded:p,duration:u}=t.progressState;this.mc(i,s),this.nb(p,new n(h,l),s),u!==o()&&this.c("duration-change",u,s)}if(c(t.volume)&&f(t.muted)){const i={muted:t.muted,volume:t.volume/100};this.c("volume-change",i,s)}c(t.playerState)&&t.playerState!==this.za&&this.ie(t.playerState,s)}z(){this.za=-1,this.md=-1,this.ga=0,this.ba=new n(0,0),this.I=null,this.R=null,this.vc=!1}}export{T as YouTubeProvider};
