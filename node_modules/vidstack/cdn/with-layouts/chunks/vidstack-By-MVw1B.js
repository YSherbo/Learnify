import{F as p,j as k,i as h,X as g,af as B,l as f,B as O,ae as x,D as u,d as b,a as y}from"./vidstack-CfWjVwmq.js";import{i as $,g as j}from"./vidstack-CyRzesiL.js";function F(i,t){const s=new URLSearchParams;for(const e of Object.keys(t))s.set(e,t[e]+"");return i+"?"+s.toString()}function R(i,t="preconnect"){const s=document.querySelector(`link[href="${i}"]`);if(!p(s))return!0;const e=document.createElement("link");return e.rel=t,e.href=i,e.crossOrigin="true",document.head.append(e),!0}const l={};function _(i){if(l[i])return l[i].promise;const t=k(),s=document.querySelector(`script[src="${i}"]`);if(!p(s))return t.resolve(),t.promise;const e=document.createElement("script");return e.src=i,e.onload=()=>{t.resolve(),delete l[i]},e.onerror=()=>{t.reject(),delete l[i]},setTimeout(()=>document.head.append(e),0),t.promise}function T(i){return i==="use-credentials"?"include":h(i)?"same-origin":void 0}function N({title:i,src:t,download:s}){const e=g(s)||s===""?t.src:h(s)?s:s?.url;return U({url:e,src:t,download:s})?{url:e,name:!g(s)&&!h(s)&&s?.filename||i.toLowerCase()||"media"}:null}function U({url:i,src:t,download:s}){return h(i)&&(s&&s!==!0||$(t)||j(t))}const A=Symbol(0),P=Symbol(0),D=Symbol(0),G=Symbol(0),V=Symbol(0),Z=Symbol(0),M=Symbol(0),r={Db:A,ma:P,Eb:D,Z:G,hb:V,_:Z,Mf:M};function m(i,t){return t>=i.startTime&&t<i.endTime}function v(i,t,s){let e=null,n=B();function a(){const o=h(t)?[t]:t,c=i.toArray().find(d=>o.includes(d.kind)&&d.mode==="showing");if(c!==e){if(!c){s(null),e=null;return}c.readyState==2?s(c):(s(null),O(()=>{const d=f(c,"load",()=>{s(c),d()},{once:!0})},n)),e=c}}return a(),f(i,"mode-change",a)}function q(i,t,s){v(i,t,e=>{if(!e){s("");return}const n=()=>{const a=e?.activeCues[0];s(a?.text||"")};n(),f(e,"cue-change",n)})}var w,S,C;class L extends x{constructor(t){super(),this.id="",this.label="",this.language="",this.default=!1,this.Z=!1,this.ua=0,this.U="disabled",this.Nf={},this.$c=[],this.B=[],this.Fb=[],this[w]=0,this[S]=null,this[C]=null;for(const s of Object.keys(t))this[s]=t[s];this.type||(this.type="vtt"),t.content?this._h(t):t.src||(this[r.ma]=2)}static createId(t){return`vds-${t.type}-${t.kind}-${t.src??t.label??"?"}`}get metadata(){return this.Nf}get regions(){return this.$c}get cues(){return this.B}get activeCues(){return this.Fb}get readyState(){return this[r.ma]}get mode(){return this.U}set mode(t){this.setMode(t)}addCue(t,s){let e=0,n=this.B.length;for(e=0;e<n&&!(t.endTime<=this.B[e].startTime);e++);e===n?this.B.push(t):this.B.splice(e,0,t),t instanceof TextTrackCue||this[r._]?.track.addCue(t),this.dispatchEvent(new u("add-cue",{detail:t,trigger:s})),m(t,this.ua)&&this[r.Eb](this.ua,s)}removeCue(t,s){const e=this.B.indexOf(t);if(e>=0){const n=this.Fb.includes(t);this.B.splice(e,1),this[r._]?.track.removeCue(t),this.dispatchEvent(new u("remove-cue",{detail:t,trigger:s})),n&&this[r.Eb](this.ua,s)}}setMode(t,s){this.U!==t&&(this.U=t,t==="disabled"?(this.Fb=[],this.Of()):this.readyState===2?this[r.Eb](this.ua,s):this.Pf(),this.dispatchEvent(new u("mode-change",{detail:this,trigger:s})),this[r.hb]?.())}[(w=r.ma,S=r.hb,C=r._,r.Eb)](t,s){if(this.ua=t,this.mode==="disabled"||!this.B.length)return;const e=[];for(let a=0,o=this.B.length;a<o;a++){const c=this.B[a];m(c,t)&&e.push(c)}let n=e.length!==this.Fb.length;if(!n){for(let a=0;a<e.length;a++)if(!this.Fb.includes(e[a])){n=!0;break}}this.Fb=e,n&&this.Of(s)}[r.Z](){this.Z=!0,this.U!=="disabled"&&this.Pf()}_h(t){import("https://cdn.jsdelivr.net/npm/media-captions@next/dist/prod.js").then(({parseText:s,VTTCue:e,VTTRegion:n})=>{!h(t.content)||t.type==="json"?(this.Qf(t.content,e,n),this.readyState!==3&&this.Ga()):s(t.content,{type:t.type}).then(({cues:a,regions:o})=>{this.B=a,this.$c=o,this.Ga()})})}async Pf(){if(!(!this.Z||this[r.ma]>0)){if(this[r.ma]=1,this.dispatchEvent(new u("load-start")),!this.src){this.Ga();return}try{const{parseResponse:t,VTTCue:s,VTTRegion:e}=await import("https://cdn.jsdelivr.net/npm/media-captions@next/dist/prod.js"),n=this[r.Db]?.(),a=fetch(this.src,{headers:this.type==="json"?{"Content-Type":"application/json"}:void 0,credentials:T(n)});if(this.type==="json")this.Qf(await(await a).text(),s,e);else{const{errors:o,metadata:c,regions:d,cues:E}=await t(a,{type:this.type,encoding:this.encoding});if(o[0]?.code===0)throw o[0];this.Nf=c,this.$c=d,this.B=E}this.Ga()}catch(t){this.Rf(t)}}}Ga(){if(this[r.ma]=2,!this.src||this.type!=="vtt"){const s=this[r._];if(s&&!s.managed)for(const e of this.B)s.track.addCue(e)}const t=new u("load");this[r.Eb](this.ua,t),this.dispatchEvent(t)}Rf(t){this[r.ma]=3,this.dispatchEvent(new u("error",{detail:t}))}Qf(t,s,e){try{const{regions:n,cues:a}=I(t,s,e);this.$c=n,this.B=a}catch(n){this.Rf(n)}}Of(t){this.dispatchEvent(new u("cue-change",{trigger:t}))}}const Q=/captions|subtitles/;function J(i){return Q.test(i.kind)}function I(i,t,s){const e=h(i)?JSON.parse(i):i;let n=[],a=[];return e.regions&&s&&(n=e.regions.map(o=>Object.assign(new s,o))),(e.cues||b(e))&&(a=(b(e)?e:e.cues).filter(o=>y(o.startTime)&&y(o.endTime)).map(o=>Object.assign(new t(0,0,""),o))),{regions:n,cues:a}}export{r as T,L as a,m as b,N as c,q as d,F as e,T as g,J as i,_ as l,R as p,v as w};
